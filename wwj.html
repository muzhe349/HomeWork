<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°„å‡»æ¸¸æˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: white;
        }

        .game-container {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .game-title {
            text-align: center;
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        canvas {
            border: 2px solid #4CAF50;
            border-radius: 5px;
            background: #000;
            display: block;
            margin: 0 auto;
        }

        .controls {
            margin-top: 15px;
            text-align: center;
            font-size: 1.1em;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        .start-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1.1em;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s;
        }

        button:hover {
            background: #45a049;
        }

        .instructions {
            margin-top: 20px;
            text-align: center;
            font-size: 1em;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-title">ğŸ® å°„å‡»æ¸¸æˆ</div>
        <div class="game-info">
            <span>å¾—åˆ†: <span id="score">0</span></span>
            <span>æ—¶é—´: <span id="time">0</span>ç§’</span>
            <span>é€Ÿåº¦: <span id="speed">1</span></span>
            <span>ä¼¤å®³: <span id="damage">1</span></span>
        </div>
        <canvas id="gameCanvas" width="800" height="500"></canvas>
        <div class="controls">
            æ“ä½œ: W/S æˆ– â†‘/â†“ ç§»åŠ¨ | ç©ºæ ¼æš‚åœ | ESCé€€å‡º
        </div>
    </div>

    <div id="startScreen" class="start-screen">
        <h2>ğŸ¯ å°„å‡»æ¸¸æˆ</h2>
        <p>åœ¨4æ¡è½¨é“é—´ç§»åŠ¨ï¼Œè‡ªåŠ¨å°„å‡»æ‘§æ¯éšœç¢ç‰©</p>
        <p>æ”¶é›†å¼ºåŒ–é“å…·æå‡èƒ½åŠ›ï¼Œç”Ÿå­˜æ—¶é—´è¶Šé•¿å¾—åˆ†è¶Šé«˜</p>
        <button onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
        <div class="instructions">
            <p><strong>æ“ä½œè¯´æ˜:</strong></p>
            <p>W/S æˆ– â†‘/â†“ : ä¸Šä¸‹ç§»åŠ¨</p>
            <p>ç©ºæ ¼é”®: æš‚åœ/ç»§ç»­</p>
            <p>ESC: é€€å‡ºæ¸¸æˆ</p>
            <p><strong>æ¸¸æˆå…ƒç´ :</strong></p>
            <p>ğŸŸ¦ ç©å®¶ | ğŸ”´ éšœç¢ç‰© | âš¡ å­å¼¹ | ğŸŸ¡ é€Ÿåº¦é“å…· | ğŸŸ¢ ä¼¤å®³é“å…·</p>
        </div>
    </div>

    <div id="gameOverScreen" class="game-over">
        <h2>æ¸¸æˆç»“æŸ</h2>
        <p>æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></p>
        <p>ç”Ÿå­˜æ—¶é—´: <span id="finalTime">0</span> ç§’</p>
        <button onclick="restartGame()">é‡æ–°å¼€å§‹</button>
    </div>

    <script>
        // æ¸¸æˆå¸¸é‡
        const CANVAS_WIDTH = 800;
        const CANVAS_HEIGHT = 500;
        const TRACKS = 4;
        const PLAYER_SIZE = 20;
        const BULLET_SIZE = 4;
        const OBSTACLE_SIZE = 20;
        const POWERUP_SIZE = 15;
        const TRACK_HEIGHT = CANVAS_HEIGHT / TRACKS;

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            isRunning: false,
            isPaused: false,
            score: 0,
            gameTime: 0,
            bulletSpeed: 1,
            bulletDamage: 1,
            startTime: Date.now(),
            lastMoveTime: 0,
            moveCooldown: 200 // ç§»åŠ¨å†·å´æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        };

        // æ¸¸æˆå¯¹è±¡
        let player = {
            x: 50,
            y: CANVAS_HEIGHT / 2,
            track: 1,
            size: PLAYER_SIZE
        };

        let bullets = [];
        let obstacles = [];
        let powerups = [];

        // Canvas è®¾ç½®
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // é”®ç›˜çŠ¶æ€
        let keys = {};

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            player.x = 50;
            player.y = CANVAS_HEIGHT / 2;
            player.track = 1;
            bullets = [];
            obstacles = [];
            powerups = [];
            gameState.score = 0;
            gameState.gameTime = 0;
            gameState.bulletSpeed = 1;
            gameState.bulletDamage = 1;
            gameState.startTime = Date.now();
            updateUI();
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            gameState.isRunning = true;
            gameState.isPaused = false;
            initGame();
            gameLoop();
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            startGame();
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameState.isRunning = false;
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalTime').textContent = gameState.gameTime;
            document.getElementById('gameOverScreen').style.display = 'block';
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('time').textContent = gameState.gameTime;
            document.getElementById('speed').textContent = gameState.bulletSpeed;
            document.getElementById('damage').textContent = gameState.bulletDamage;
        }

        // ç§»åŠ¨ç©å®¶
        function movePlayer(direction) {
            const currentTime = Date.now();
            if (currentTime - gameState.lastMoveTime < gameState.moveCooldown) {
                return; // è¿˜åœ¨å†·å´ä¸­ï¼Œä¸å…è®¸ç§»åŠ¨
            }
            
            const newTrack = player.track + direction;
            if (newTrack >= 0 && newTrack < TRACKS) {
                player.track = newTrack;
                player.y = (player.track + 0.5) * TRACK_HEIGHT;
                gameState.lastMoveTime = currentTime; // è®°å½•ç§»åŠ¨æ—¶é—´
            }
        }

        // å°„å‡»
        function shoot() {
            bullets.push({
                x: player.x + player.size / 2,
                y: player.y,
                size: BULLET_SIZE,
                damage: gameState.bulletDamage
            });
        }

        // ç”Ÿæˆéšœç¢ç‰©
        function generateObstacle() {
            if (Math.random() < 0.02) {
                const track = Math.floor(Math.random() * TRACKS);
                const health = 1 + Math.floor(gameState.gameTime / 30);
                obstacles.push({
                    x: CANVAS_WIDTH,
                    y: (track + 0.5) * TRACK_HEIGHT,
                    size: OBSTACLE_SIZE,
                    health: health,
                    maxHealth: health
                });
            }
        }

        // ç”Ÿæˆå¼ºåŒ–é“å…·
        function generatePowerup() {
            if (Math.random() < 0.005) {
                const track = Math.floor(Math.random() * TRACKS);
                const type = Math.random() < 0.5 ? 'speed' : 'damage';
                powerups.push({
                    x: CANVAS_WIDTH,
                    y: (track + 0.5) * TRACK_HEIGHT,
                    size: POWERUP_SIZE,
                    type: type
                });
            }
        }

        // æ›´æ–°å­å¼¹
        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                bullets[i].x += 5;
                if (bullets[i].x > CANVAS_WIDTH) {
                    bullets.splice(i, 1);
                }
            }
        }

        // æ›´æ–°éšœç¢ç‰©
        function updateObstacles() {
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].x -= 2;
                if (obstacles[i].x + obstacles[i].size < 0) {
                    obstacles.splice(i, 1);
                }
            }
        }

        // æ›´æ–°å¼ºåŒ–é“å…·
        function updatePowerups() {
            for (let i = powerups.length - 1; i >= 0; i--) {
                powerups[i].x -= 2;
                if (powerups[i].x + powerups[i].size < 0) {
                    powerups.splice(i, 1);
                }
            }
        }

        // ç¢°æ’æ£€æµ‹
        function checkCollisions() {
            // ç©å®¶ä¸éšœç¢ç‰©ç¢°æ’
            for (let obstacle of obstacles) {
                if (isColliding(player, obstacle)) {
                    gameOver();
                    return;
                }
            }

            // ç©å®¶ä¸å¼ºåŒ–é“å…·ç¢°æ’
            for (let i = powerups.length - 1; i >= 0; i--) {
                if (isColliding(player, powerups[i])) {
                    if (powerups[i].type === 'speed') {
                        gameState.bulletSpeed = Math.min(gameState.bulletSpeed + 1, 8);
                    } else {
                        gameState.bulletDamage = Math.min(gameState.bulletDamage + 1, 5);
                    }
                    powerups.splice(i, 1);
                }
            }

            // å­å¼¹ä¸éšœç¢ç‰©ç¢°æ’
            for (let i = bullets.length - 1; i >= 0; i--) {
                for (let j = obstacles.length - 1; j >= 0; j--) {
                    if (isColliding(bullets[i], obstacles[j])) {
                        obstacles[j].health -= bullets[i].damage;
                        bullets.splice(i, 1);
                        if (obstacles[j].health <= 0) {
                            obstacles.splice(j, 1);
                        }
                        break;
                    }
                }
            }
        }

        // ç¢°æ’æ£€æµ‹è¾…åŠ©å‡½æ•°
        function isColliding(obj1, obj2) {
            return obj1.x < obj2.x + obj2.size &&
                   obj1.x + obj1.size > obj2.x &&
                   obj1.y < obj2.y + obj2.size &&
                   obj1.y + obj1.size > obj2.y;
        }

        // æ¸²æŸ“æ¸¸æˆ
        function render() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // ç»˜åˆ¶è½¨é“çº¿
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            for (let i = 1; i < TRACKS; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * TRACK_HEIGHT);
                ctx.lineTo(CANVAS_WIDTH, i * TRACK_HEIGHT);
                ctx.stroke();
            }

            // ç»˜åˆ¶ç©å®¶
            ctx.fillStyle = '#4CAF50';
            ctx.fillRect(player.x, player.y - player.size / 2, player.size, player.size);

            // ç»˜åˆ¶å­å¼¹
            ctx.fillStyle = '#FFD700';
            for (let bullet of bullets) {
                ctx.fillRect(bullet.x, bullet.y - bullet.size / 2, bullet.size, bullet.size);
            }

            // ç»˜åˆ¶éšœç¢ç‰©
            for (let obstacle of obstacles) {
                const healthPercent = obstacle.health / obstacle.maxHealth;
                ctx.fillStyle = `rgb(${255 * (1 - healthPercent)}, ${255 * healthPercent}, 0)`;
                ctx.fillRect(obstacle.x, obstacle.y - obstacle.size / 2, obstacle.size, obstacle.size);
            }

            // ç»˜åˆ¶å¼ºåŒ–é“å…·
            for (let powerup of powerups) {
                if (powerup.type === 'speed') {
                    ctx.fillStyle = '#FFD700';
                } else {
                    ctx.fillStyle = '#FF6B6B';
                }
                ctx.fillRect(powerup.x, powerup.y - powerup.size / 2, powerup.size, powerup.size);
            }

            // ç»˜åˆ¶æš‚åœæç¤º
            if (gameState.isPaused) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                ctx.fillStyle = '#FFF';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('æ¸¸æˆæš‚åœ', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2);
                ctx.font = '24px Arial';
                ctx.fillText('æŒ‰ç©ºæ ¼é”®ç»§ç»­', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 + 50);
            }
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            if (!gameState.isRunning) return;

            // æ›´æ–°æ¸¸æˆæ—¶é—´
            gameState.gameTime = Math.floor((Date.now() - gameState.startTime) / 1000);
            gameState.score = gameState.gameTime;

            if (!gameState.isPaused) {
                // å¤„ç†è¾“å…¥
                if (keys['ArrowUp'] || keys['w'] || keys['W']) {
                    movePlayer(-1);
                }
                if (keys['ArrowDown'] || keys['s'] || keys['S']) {
                    movePlayer(1);
                }

                // è‡ªåŠ¨å°„å‡»
                if (gameState.gameTime % (10 - gameState.bulletSpeed) === 0) {
                    shoot();
                }

                // æ›´æ–°æ¸¸æˆå¯¹è±¡
                updateBullets();
                generateObstacle();
                generatePowerup();
                updateObstacles();
                updatePowerups();
                checkCollisions();
            }

            // æ¸²æŸ“
            render();
            updateUI();

            // ç»§ç»­å¾ªç¯
            requestAnimationFrame(gameLoop);
        }

        // é”®ç›˜äº‹ä»¶å¤„ç†
        document.addEventListener('keydown', function(e) {
            keys[e.key] = true;
            
            if (e.key === ' ') {
                e.preventDefault();
                if (gameState.isRunning) {
                    gameState.isPaused = !gameState.isPaused;
                }
            }
            
            if (e.key === 'Escape') {
                if (gameState.isRunning) {
                    gameOver();
                }
            }
        });

        document.addEventListener('keyup', function(e) {
            keys[e.key] = false;
        });

        // é˜²æ­¢æ–¹å‘é”®æ»šåŠ¨é¡µé¢
        window.addEventListener('keydown', function(e) {
            if(['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                e.preventDefault();
            }
        });

        // åˆå§‹åŒ–
        initGame();
    </script>
</body>
</html> 